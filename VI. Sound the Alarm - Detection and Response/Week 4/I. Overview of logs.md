# The importance of logs

- **Definition of Logs:** **[[Log]]** are records of events that occur within an organization's systems. They serve as a detailed account of various events or occurrences. Nearly every device or system can generate logs, making them valuable for security analysts.
	- **Log Contents:** Logs record information about events, including the ***date and time, location, actions taken, and the names of users or systems involved***. This data is essential for both troubleshooting system issues and, most importantly, for security monitoring. Logs enable security analysts to create a narrative and timeline of events, helping them understand what transpired.
	- **Log Analysis:** **[[Log analysis]]** is the process of examining logs to identify events of interest. Given the vast amount of log data generated from different sources, it's important to be selective about what to log. This selective logging approach helps reduce the time spent sifting through log data.
- **[[SIEM (Security Information and Event Management)]]:** SIEM tools play a crucial role in log management. They collect data from multiple sources, aggregate or centralize the data in one location, and normalize diverse log formats into a single preferred format. SIEM tools enable security analysts to process large log volumes in real-time, supporting their investigations.
- **Log Collection:** **[[Log forwarders]]**, which are software applications, collect logs from various sources and automatically forward them to a centralized log repository for storage.
	- **Types of Log Data Sources:** Different devices and systems create logs, resulting in various types of log data sources. These include: 
		- **Network logs** (e.g., from routers, switches, firewalls)
		- **System logs** (from operating systems)
		- **Application logs** (related to software applications)
		- **Security logs** (from security tools like IDS or IPS)
		- **Authentication logs** (recording login attempts)
- **Example of Network Log:** The video provides an example of a network log from a router. The log entry includes information about the action (ALLOW), the source IP address, and the timestamp, which is crucial for establishing a timeline of events.

![[Pasted image 20231030181048.png]]

Understanding and analyzing logs is a fundamental skill for security professionals, as it helps in detecting and investigating security incidents, as well as ensuring the overall security of an organization's systems and networks.

# Best practices for log collection and management

In this reading, you’ll examine some best practices related to log management, storage, and protection. Understanding the best practices related to log collection and management will help improve log searches and better support your efforts in identifying and resolving security incidents.

## Logs

Data sources such as devices generate data in the form of events. A **[[log]]** is a record of events that occur within an organization's systems. Logs contain log entries and each entry details information corresponding to a single event that happened on a device or system. Originally, logs served the sole purpose of troubleshooting common technology issues. For example, error logs provide information about why an unexpected error occurred and help to identify the root cause of the error so that it can be fixed. Today, virtually all computing devices produce some form of logs that provide valuable insights beyond troubleshooting. 

Security teams access logs from logging receivers like SIEM tools which consolidate logs to provide a central repository for log data. Security professionals use logs to perform **[[log analysis]]**, which is the process of examining logs to identify events of interest. Logs help uncover the details surrounding the 5 W's of incident investigation: _who_ triggered the incident, _what_ happened, _when_ the incident took place, _where_ the incident took place, and _why_ the incident occurred. 

### **Types of logs**

Depending on the data source, different log types can be produced. Here’s a list of some common log types that organizations should record:

- **[[Network logs]]**: Network logs are generated by network devices like firewalls, routers, or switches.
- **[[System logs]]**: System logs are generated by operating systems like Chrome OS™, Windows, Linux, or macOS®. 
- **[[Application logs]]**: Application logs are generated by software applications and contain information relating to the events occurring within the application such as a smartphone app.
- **[[Security logs]]**: Security logs are generated by various devices or systems such as antivirus software and intrusion detection systems. Security logs contain security-related information such as file deletion.
- **[[Authentication logs]]**: Authentication logs are generated whenever authentication occurs such as a successful login attempt into a computer.

### **Log details**

Generally, logs contain a date, time, location, action, and author of the action, **[[Log details]]**. Here is an example of an authentication log:

`Login Event [05:45:15] User1 Authenticated successfully`

Logs contain information and can be adjusted to contain even more information. Verbose logging records additional, detailed information beyond the default log recording. Here is an example of the same log above but logged as verbose.

`Login Event [2022/11/16 05:45:15.892673] auth_performer.cc:470 User1 Authenticated successfully from device1 (192.168.1.2)`

## Log management

Because all devices produce logs, it can quickly become overwhelming for organizations to keep track of all the logs that are generated. To get the most value from your logs, you need to choose exactly what to log, how to access it easily, and keep it secure using log management. **[[Log management]]** is the process of collecting, storing, analyzing, and disposing of log data. 

### **What to log**

The most important aspect of log management is choosing what to log. Organizations are different, and their logging requirements can differ too. It's important to consider which log sources are most likely to contain the most useful information depending on your event of interest. This might be configuring log sources to reduce the amount of data they record, such as excluding excessive verbosity. Some information, including but not limited to phone numbers, email addresses, and names, form personally identifiable information (PII), which requires special handling and in some jurisdictions might not be possible to be logged.

### **The issue with overlogging**

From a security perspective, it can be tempting to log everything. This is the most common mistake organizations make. Just because it can be logged, doesn't mean it _needs_ to be logged. Storing excessive amounts of logs can have many disadvantages with some SIEM tools. For example, overlogging can increase storage and maintenance costs. Additionally, overlogging can increase the load on systems, which can cause performance issues and affect usability, making it difficult to search for and identify important events. 

### **Log retention**

Organizations might operate in industries with regulatory requirements. For example, some regulations require organizations to retain logs for set periods of time and organizations can implement log retention practices in their log management policy.

Organizations that operate in the following industries might need to modify their log management policy to meet regulatory requirements:

- Public sector industries, like the Federal Information Security Modernization Act (FISMA)
- Healthcare industries, like the Health Insurance Portability and Accountability Act of 1996 (HIPAA)
- Financial services industries, such as the Payment Card Industry Data Security Standard (PCI DSS), the Gramm-Leach-Bliley Act (GLBA), and the Sarbanes-Oxley Act of 2002 (SOX)

### **Log protection**

Along with management and retention, the protection of logs is vital in maintaining log integrity. It’s not unusual for malicious actors to modify logs in attempts to mislead security teams and to even hide their activity.

Storing logs in a centralized log server is a way to maintain log integrity. When logs are generated, they get sent to a dedicated server instead of getting stored on a local machine. This makes it more difficult for attackers to access logs because there is a barrier between the attacker and the log location. 

## Key takeaways

It's important to understand how to properly collect, store, and protect logs because they are integral to incident investigations. Having a detailed plan for log management helps improve the usefulness of logs and resource efficiency.

# Variations of logs

- **Comparison to Receipts:** Logs are likened to receipts in the sense that they record events or activities that occur on a network or system. While not all store receipts look the same, they all contain crucial transaction details. Similarly, logs may come in different formats but typically include information such as ***timestamps, system characteristics (e.g., IP addresses), a description of the event, the action taken, and the user who performed the action***.
- **Log Formats:** Logs can be generated from various data sources like network devices, operating systems, and more. As a result, they come in different formats, which may be human-readable or machine-readable, verbose or concise. 
	- **Common log formats include:**
		- **[[Syslog]]:** Syslog is a widely used log format that includes a ***header, structured data, and a message***. The **header** contains fields like Timestamp, Hostname, Application name, and Message ID. The **structured-data section** contains additional key-value pairs. The **message** component provides detailed information about the event.![[Pasted image 20231101204337.png]]
		- **[[JavaScript Object Notation (JSON)]]:** JSON is a text-based format known for its simplicity and easy readability. It uses ***key-value pairs*** organized within curly brackets. Each key is followed by a colon and its corresponding value.![[Pasted image 20231101203839.png]]
		- **[[eXtensible Markup Language (XML)]]:** XML is a format used for storing and transmitting data. Unlike key-value pairs, it ***uses tags and keys*** to structure data. An XML log entry includes fields enclosed in tags.![[Pasted image 20231101204035.png]]
		- **[[Comma Separated Values (CSV)]]:** CSV is a format that uses separators like commas to separate data values. It's commonly used to store tabular data.![[Pasted image 20231101204139.png]]
Understanding different log formats is crucial for a security analyst because logs provide vital information for detecting, investigating, and responding to security incidents. The knowledge of log formats allows analysts to effectively evaluate logs and build context around detection.

# Overview of log file formats

You’ve learned about how logs record events that happen on a network, or system. In security, logs provide key details about activities that occurred across an organization, like who signed into an application at a specific point in time. As a security analyst, you’ll use **log analysis**, which is the process of examining logs to identify events of interest. It’s important to know how to read and interpret different log formats so that you can uncover the key details surrounding an event and identify unusual or malicious activity. In this reading, you’ll review the following log formats:

- JSON
- Syslog
- XML
- CSV
- CEF

## JavaScript Object Notation (JSON)

JavaScript Object Notation (JSON) is a file format that is used to store and transmit data. JSON is known for being lightweight and easy to read and write. It is used for transmitting data in web technologies and is also commonly used in cloud environments. JSON syntax is derived from JavaScript syntax. If you are familiar with JavaScript, you might recognize that JSON contains components from JavaScript including:

- Key-value pairs
- Commas
- Double quotes
- Curly brackets
- Square brackets

### **Key-value pairs**

A **key-value** **pair** is a set of data that represents two linked items: a key and its corresponding value. A key-value pair consists of a key followed by a colon, and then followed by a value. An example of a key-value pair is  `"Alert": "Malware"`.

**Note**: For readability, it is recommended that key-value pairs contain a space before or after the colon that separates the key and value.

### **Commas**

Commas are used to separate data. For example: `"Alert": "Malware", "Alert code": 1090, "severity": 10`.

### **Double quotes**

Double quotes are used to enclose _text_ data, which is also known as a string, for example:  `"Alert": "Malware"`. Data that contains numbers _is not_ enclosed in quotes, like this: `"Alert code": 1090`.

### **Curly brackets**

Curly brackets enclose an **object**, which is a data type that stores data in a comma-separated list of key-value pairs. Objects are often used to describe multiple properties for a given key. JSON log entries start and end with a curly bracket. In this example, `User` is the object that contains multiple properties:

```JSON
"User" 
{  
	"id": "1234",  
	"name": "user", 
	"role": "engineer" 
}
```

### **Square brackets**

Square brackets are used to enclose an **array**, which is a data type that stores data in a comma-separated ordered list. Arrays are useful when you want to store data as an ordered collection, for example: `["Administrators", "Users", "Engineering"]`.

## Syslog

Syslog is a standard for logging and transmitting data. It can be used to refer to any of its three different capabilities: 

1. **Protocol**: The syslog protocol is used to transport logs to a centralized log server for log management. It uses port 514 for plaintext logs and port 6514 for encrypted logs.
2. **Service**: The syslog service acts as a log forwarding service that consolidates logs from multiple sources into a single location. The service works by receiving and then forwarding any syslog log entries to a remote server. 
3. **Log format**: The syslog log format is one of the most commonly used log formats that you will be focusing on. It is the native logging format used in  Unix® systems. It consists of three components: a header, structured-data, and a message.

## Syslog log example

Here is an example of a syslog entry that contains all three components: a header, followed by structured-data, and a message:

```syslog
<236>1 2022-03-21T01:11:11.003Z virtual.machine.com evntslog - ID01 [user@32473 iut="1" eventSource="Application" eventID="9999"] This is a log entry!
```

### **Header** 

The header contains details like the timestamp; the hostname, which is the name of the machine that sends the log; the application name; and the message ID. 

- **Timestamp**: The timestamp in this example is `2022-03-21T01:11:11.003Z`, where `2022-03-21` is the date in YYYY-MM-DD format. `T` is used to separate the date and the time. 01:11:11.003 is the 24-hour format of the time and includes the number of milliseconds `003`. `Z` indicates the timezone, which is Coordinated Universal Time (UTC). 

- **Hostname**: `virtual.machine.com`
- **Application**: `evntslog` 
- **Message** **ID**: `ID01`

### **Structured-data** 

The structured-data portion of the log entry contains additional logging information. This information is enclosed in square brackets and structured in key-value pairs. Here, there are three keys with corresponding values: 
`[user@32473 iut="1" eventSource="Application" eventID="9999"]`.

### **Message** 

The message contains a detailed log message about the event. Here, the message is `This is a log entry!`.

### **Priority (PRI)**

The priority (PRI) field indicates the urgency of the logged event and is contained with angle brackets. In this example, the priority value is `<236>` . Generally, the lower the priority level, the more urgent the event is. 

**Note**: Syslog headers can be combined with JSON, and XML formats. Custom log formats also exist.

## XML (eXtensible Markup Language)

XML (eXtensible Markup Language) is a language and a format used for storing and transmitting data. XML is a native file format used in Windows systems. XML syntax uses the following:

- Tags
- Elements
- Attributes

### **Tags** 

XML uses tags to store and identify data. Tags are pairs that must contain a start tag and an end tag. The start tag encloses data with angle brackets, for example `<tag>`,  whereas the end of a tag encloses data with angle brackets and a forward slash like this: `</tag>`. 

### **Elements** 

XML elements include _both_ the data contained inside of a tag and the tags itself. All XML entries must contain at least one root element. Root elements contain other elements that sit underneath them, known as child elements. 

Here is an example:

```XML
<Event> 
	<EventID>4688</EventID> 
	<Version>5</Version> 
</Event>
```

In this example, `<Event>` is the root element and contains two child elements `<EventID>` and `<Version>`. There is data contained in each respective child element.

### **Attributes**

XML elements can also contain attributes. Attributes are used to provide additional information about elements. Attributes are included as the second part of the tag itself and must always be quoted using either single or double quotes.

For example:

```XML
<EventData> 
	<Data Name='SubjectUserSid'>S-2-3-11-160321</Data> 
	<Data Name='SubjectUserName'>JSMITH</Data> 
	<Data Name='SubjectDomainName'>ADCOMP</Data> 
	<Data Name='SubjectLogonId'>0x1cf1c12</Data> 
	<Data Name='NewProcessId'>0x1404</Data> 
</EventData>
```

In the first line for this example, the tag is `<Data>` and it uses the attribute  `Name='SubjectUserSid'` to describe the data enclosed in the tag `S-2-3-11-160321`.

## CSV (Comma Separated Value)

CSV (Comma Separated Value) uses commas to separate data values. In CSV logs, the position of the data corresponds to its field name, but the field names themselves might not be included in the log. It’s critical to understand what fields the source device (like an IPS, firewall, scanner, etc.) is including in the log. 

Here is an example:

```CSV
2009-11-24T21:27:09.534255,ALERT,192.168.2.7, 1041,x.x.250.50,80,TCP,ALLOWED,1:2001999:9,"ET MALWARE BTGrab.com Spyware Downloading Ads",1
```

## CEF (Common Event Format)

**Common Event Format (CEF)** is a log format that uses key-value pairs to structure data and identify fields and their corresponding values. The CEF syntax is defined as containing the following fields: 

```CSV
CEF:Version|Device Vendor|Device Product|Device Version|Signature ID|Name|Severity|Extension 
```

Fields are all separated with a pipe character |. However, anything in the Extension part of the CEF log entry must be written in a key-value format. Syslog is a common method used to transport logs like CEF. When Syslog is used a timestamp and hostname will be prepended to the CEF message. Here is an example of a CEF log entry that details malicious activity relating to a worm infection:

```CSV
Sep 29 08:26:10 host CEF:1|Security|threatmanager|1.0|100|worm successfully stopped|10|src=10.0.0.2 dst=2.1.2.2 spt=1232
```

Here is a breakdown of the fields:

- **Syslog Timestamp**: `Sep 29 08:26:10`
- **Syslog Hostname**: `host`
- **Version**: `CEF:1`
- **Device Vendor**: `Security`
- **Device Product**: `threatmanager`
- **Device Version**: `1.0`
- **Signature ID**: `100`
- **Name**: `worm successfully stopped`
- **Severity**: `10`
- **Extension**: This field contains data written as key-value pairs. There are two IP addresses, `src=10.0.0.2` and `dst=2.1.2.2`, and a source port number `spt=1232`. Extensions are not required and are optional to add.

This log entry contains details about a `Security` application called `threatmanager` that `successfully stopped a worm` from spreading from the internal network at `10.0.0.2` to the external network `2.1.2.2` through the port `1232`. A high severity level of `10` is reported.

**Note**: Extensions and syslog prefix are optional to add to a CEF log.

## Key takeaways

There is no standard format used in logging, and many different log formats exist. As a security analyst, you will analyze logs that originate from different sources. Knowing how to interpret different log formats will help you determine key information that you can use to support your investigations.

## Resources for more information

- To learn more about the syslog protocol including priority levels, check out [The Syslog Protocol](https://www.rfc-editor.org/rfc/rfc5424).
- If you would like to explore generating log formats, check out this open-source [test data generator tool](https://generatedata.com/).
- To learn more about timestamp formats, check out [Date and Time on the Internet: Timestamps](https://www.rfc-editor.org/rfc/rfc3339).